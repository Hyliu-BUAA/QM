# 1. Way 1: 由 POSCAR 运行 `mcsqs`
## 1.1. Step 1: POSCAR 转换成 `lat.in` 格式 (`lat.in` 与`rndstr.in` 非常相似)
```shell
$ echo 4, 414, 1 | vaspkit
```

### 处理前的 `POSCAR`
```txt
POSCAR
1.00
  -10.47950000  -18.15102600    0.00000000
   20.95900000    0.00000000    0.00000000
    0.00000000    0.00000000   23.37150000
  Nb   S
  36   72
Direct
  0.88889000  0.94445000  0.50000000
  0.05554700  0.11110700  0.50000000
  0.88889000  0.11112000  0.50000000
  0.05554700  0.44443700  0.50000000
  0.88889000  0.44445000  0.50000000
  0.05554700  0.61110700  0.50000000
  0.88889000  0.61112000  0.50000000
  0.72222000  0.94445000  0.50000000
  0.55556000  0.77779000  0.50000000
  ...
```


### 处理后的 `lat.in`
```txt
    20.95900    20.95900    23.37150   90.00   90.00  120.00
    1.00000000    0.00000000    0.00000000
    0.00000000    1.00000000    0.00000000
    0.00000000    0.00000000    1.00000000

    0.88889000    0.94445000    0.50000000  Nb
    0.05554700    0.11110700    0.50000000  Nb
    0.88889000    0.11112000    0.50000000  Nb
    0.05554700    0.44443700    0.50000000  Nb
    0.88889000    0.44445000    0.50000000  Nb
    0.05554700    0.61110700    0.50000000  Nb
    0.88889000    0.61112000    0.50000000  Nb
    ....
```


### `lat.in` `rndstr.in`
```shell
# 1. vim 多行编辑修改浓度

# 2. 改名
$ mv lat.in rndstr.in
```

```txt
    20.95900    20.95900    23.37150   90.00   90.00  120.00
    1.00000000    0.00000000    0.00000000
    0.00000000    1.00000000    0.00000000
    0.00000000    0.00000000    1.00000000

    0.88889000    0.94445000    0.50000000  Nb=0.5,Re=0.5
    0.05554700    0.11110700    0.50000000  Nb=0.5,Re=0.5
    0.88889000    0.11112000    0.50000000  Nb=0.5,Re=0.5
    0.05554700    0.44443700    0.50000000  Nb=0.5,Re=0.5
    0.88889000    0.44445000    0.50000000  Nb=0.5,Re=0.5
    0.05554700    0.61110700    0.50000000  Nb=0.5,Re=0.5
    0.88889000    0.61112000    0.50000000  Nb=0.5,Re=0.5
    0.72222000    0.94445000    0.50000000  Nb=0.5,Re=0.5
    0.55556000    0.77779000    0.50000000  Nb=0.5,Re=0.5
    0.55556000    0.94445000    0.50000000  Nb=0.5,Re=0.5
    0.55556000    0.11112000    0.50000000  Nb=0.5,Re=0.5
    0.55556000    0.44445000    0.50000000  Nb=0.5,Re=0.5
    ...
```



## 1.2. Step 2: 生成团簇信息
```shell
### pair 直径小于 6, triplet 直径小于 5.2

# Way 1
$ mcsqs -2=6 -3=5.2

# Way 2
$ corrdump -clus -noe -nop -ro -l=rndstr.in -2=6 -3=5.2
```

## 1.3. Step 3: 运行 `mcsqs`
```shell
# 1. 串行：指定胞的大小，二维材料
$ mcsqs -n=108 -2d 

# 2. 并行：指定胞的大小，二维材料
for (( id=0; id<10; id++ ))
do
    mcsqs -n=108 -2d -ip=${id} &
done
wait

# 3. 提高 tolerance；按照 sqscell.out 扩包搜索（防止搜索出来的胞形状不一样）
$ mcsqs -n=168 -tol=0.01 -rc
```

### `sqscell.out` 文件内容
```
1

3 0 0
0 2 0
0 0 1
```


## 1.4. 将 `bestsqs.out` 转换成 `POSCAR`
<font color="red" size="4">

1. `sqs2poscar` 脚本需要额外编译
```shell
# 1. 编译
$ g++ -Og test.cpp -o test
# 2. 添加环境变量
$ export "<your_path>/scripts/:$PATH"
```

</font>

```shell
$ sqs2poscar bestsqs.out
```


# 2. Demo: LiMnPO4 中的 空位
```shell
corrdump -nop -noe -2=6 -3=5.2 -4=5.2 -ro -l=rndstr.in -clus #设置团聚半径

mkdir Fe6
for i in {01..50};
do mkdir Fe6/$i;
mcsqs -n=168 -tol=0.01 -rc  #计算前改sqscell.out
#sed -i '/Vac/d' bestsqs.out
str2cif < bestsqs.out > str.cif
str2config bestsqs.out > atom.config
cp atom.config Fe6/$i/
done


########rndstr.in
4.792029     6.178591   10.594184    90.00000    90.00000   90
1 0 0 
0 1 0 
0 0 1
0.0000000000000000    0.0000000000000000    0.5000000000000000    Li
0.5000000000000000    0.0000000000000000    0.0000000000000000    Li
0.5000000000000000    0.5000000000000000    0.0000000000000000    Li
0.0000000000000000    0.5000000000000000    0.5000000000000000    Li
0.0274412771480000    0.7500000000000000    0.7811644577820001    Mn=0.75,Fe=0.25
0.9725525073470001    0.2500000000000000    0.2188370524810000    Mn=0.75,Fe=0.25
0.5274591558930000    0.2500000000000000    0.7188378076120000    Mn=0.75,Fe=0.25
0.4725554965900000    0.7500000000000000    0.2811637026500000    Mn=0.75,Fe=0.25
0.0895652922020000    0.2500000000000000    0.9079038083540000     P
0.9104493602810000    0.7500000000000000    0.0920977019090000     P
0.5895622688470000    0.7500000000000000    0.5920984570400000     P
0.4104315156480000    0.2500000000000000    0.4079030532220000     P
0.2225361260960000    0.0494610476890000    0.8389225635499999     O
0.2100154038570000    0.2500000000000000    0.0443545250870000     O
0.2313424512400000    0.7500000000000000    0.0965907331800000     O
0.7774785263860000    0.9505403287160000    0.1610789467130000     O
0.7899783806380000    0.7500000000000000    0.9556469851760000     O
0.7686513332560000    0.2500000000000000    0.9034107770830000     O
0.7225330642700000    0.9505402885980000    0.6610797018440000     O
0.7100123052820000    0.7500000000000000    0.4556462300450000     O
0.7313602917950000    0.2500000000000000    0.4034100219520000     O
0.2774607202250000    0.0494610878080000    0.3389218084190000    O
0.2899814792150000    0.2500000000000000    0.5443458410770000    O
0.2686543606880000    0.7500000000000000    0.5965914883110000    O
0.2774606960260000    0.4505395861250000    0.3389218084190000    O
0.7225330884690000    0.5494617902800000    0.6610797018440000    O
0.7774785505850000    0.5494618303990000    0.1610789467130000    O
0.2225361018970000    0.4505395460070000    0.8389225635499999    O
#######


########sqscell.out
1

3 0 0
0 2 0
0 0 1
########
```